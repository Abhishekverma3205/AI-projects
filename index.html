<<<<<<< HEAD
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal AI Assistant (No‚ÄëAPI)</title>
  <style>
    :root{
      --bg:#0b1020;--card:#121936;--accent:#7c5cff;--muted:#9aa4ff;--text:#e9ecff;--sub:#b9c0ff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial;color:var(--text);background:linear-gradient(135deg,#0b1020,#151a3a 60%,#0b1020)}
    /* Floating launcher */
    .launcher{position:fixed;right:18px;bottom:18px;z-index:9999}
    .launcher button{height:56px;width:56px;border-radius:50%;border:none;cursor:pointer;background:var(--accent);color:#fff;font-size:22px;box-shadow:0 10px 30px rgba(124,92,255,.35);transition:transform .15s ease, box-shadow .3s}
    .launcher button:hover{transform:translateY(-2px);box-shadow:0 14px 38px rgba(124,92,255,.5)}

    /* Chat window */
    .chat{position:fixed;right:18px;bottom:86px;width:360px;max-width:92vw;height:520px;max-height:75vh;background:var(--card);border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.08);box-shadow:0 18px 44px rgba(0,0,0,.45);display:none;flex-direction:column}
    .chat.open{display:flex}
    .top{display:flex;align-items:center;gap:10px;padding:14px 14px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,rgba(255,255,255,.04),transparent)}
    .av{height:34px;width:34px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#4f46e5);display:grid;place-items:center;font-weight:700}
    .title{font-weight:700;font-size:14px}
    .sub{font-size:12px;color:var(--sub)}

    .msgs{flex:1;overflow:auto;padding:12px 12px 8px;scroll-behavior:smooth}
    .msg{display:flex;margin:8px 0;gap:8px}
    .msg .bubble{padding:10px 12px;border-radius:12px;max-width:78%}
    .user .bubble{background:#1b2452;margin-left:auto;border-bottom-right-radius:4px}
    .bot .bubble{background:#0f1533;border:1px solid rgba(255,255,255,.06);border-bottom-left-radius:4px}
    .stamp{font-size:11px;color:var(--sub);margin:2px 4px}

    .input{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(255,255,255,.08);background:linear-gradient(0deg,rgba(255,255,255,.04),transparent)}
    .input input{flex:1;padding:12px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0d1430;color:var(--text)}
    .input button{padding:12px 14px;border-radius:12px;border:none;background:var(--accent);color:#fff;cursor:pointer}

    /* Quick actions */
    .chips{display:flex;flex-wrap:wrap;gap:8px;padding:8px 12px;border-bottom:1px dashed rgba(255,255,255,.08)}
    .chip{padding:7px 10px;border-radius:999px;font-size:12px;background:#141b3c;border:1px solid rgba(255,255,255,.08);cursor:pointer}

    /* Small helper UI */
    .hint{font-size:12px;color:var(--sub);padding:0 12px 6px}
    a.inline{color:var(--muted);text-decoration:none;border-bottom:1px dashed rgba(124,92,255,.4)}

    /* Responsive tweaks */
    @media (max-width:420px){.chat{width:96vw;right:2vw}}
  </style>
</head>
<body>

  <!-- Launcher -->
  <div class="launcher" aria-live="polite" aria-label="Open chat">
    <button id="openChat" title="Chat with assistant">üí¨</button>
  </div>

  <!-- Chat Window -->
  <section class="chat" id="chat">
    <header class="top">
      <div class="av">AI</div>
      <div>
        <div class="title">tera bhai hu kuch bhi poch</div>
        <div class="sub">Ask anything ‚Ä¢ Online</div>
      </div>
      <button id="closeChat" style="margin-left:auto;background:transparent;border:none;color:var(--sub);font-size:20px;cursor:pointer">‚úï</button>
    </header>

    <div class="chips" id="chips"></div>
    <div class="hint">Tip: "login kaise karein", "pricing", "contact", "EMI calculator"‚Äîkuch bhi puchhiye.</div>

    <main class="msgs" id="msgs" role="log" aria-live="polite"></main>

    <footer class="input">
      <input id="box" placeholder="Type your question‚Ä¶ (Enter to send)" autocomplete="off" />
      <button id="send">Send ‚Æû</button>
    </footer>
  </section>

  <script>
    /**********************
     * 1) Knowledge Base  *
     **********************/
    // Edit / add Q&A here. Each item can have:
    // - patterns: phrases to detect
    // - answer: HTML/text to send back
    // - actions: optional functions to run (like scroll to a section)
    const KB = [
      {
        id: 'greet',
        patterns: ['hello','hi','hey','namaste','pranam','suprabhat','good morning','good evening'],
        answer: `Namaste! üëã Main aapka site assistant hoon. Bataiye, mai kaise madad karu?`,
      },
      {
        id: 'login',
        patterns: ['login','sign in','signin','account access','how to login','kaise login karu','login kaise kare'],
        answer: `Login karne ke liye top-right pe <b>Login</b> button dabaiye. Agar account nahi hai to <b>Sign Up</b> kijiye, fir email verify karke dubara login kijiye. Password bhool gaye? <a class="inline" href="#" onclick="assistant.fakeAction('reset')">Reset yahan se</a>.`,
      },
      {
        id: 'signup',
        patterns: ['sign up','signup','register','account banana','naya account'],
        answer: `Sign Up ke liye naam, email aur strong password daliye. Verification mail aayega‚Äîconfirm karte hi account ready!`,
      },
      {
        id: 'pricing',
        patterns: ['price','pricing','plan','plans','kitna paisa','charges','fees'],
        answer: `Hamare plans: <ul style="margin:6px 0 0 18px">
          <li><b>Free</b> ‚Äì basic features</li>
          <li><b>Pro</b> ‚Äì ‚Çπ299/month ‚Äì advanced tools</li>
          <li><b>Business</b> ‚Äì custom pricing ‚Äì team features</li>
        </ul> Payment UPI/NetBanking/Cards se ho sakta hai.`,
      },
      {
        id: 'contact',
        patterns: ['contact','support','help','customer care','phone','email','reach out'],
        answer: `Madad chahiye? Hume <a class="inline" href="mailto:support@example.com">support@example.com</a> par mail karein ya <a class="inline" href="#" onclick="assistant.fakeAction('call')">callback request</a> chhodiye.`,
      },
      {
        id: 'emi',
        patterns: ['emi','loan','installment','interest calculator','emi calculator'],
        answer: `EMI calculator yahan milega: <a class="inline" href="#" onclick="assistant.fakeAction('emi')">Open EMI Tool</a>. Principal, rate aur tenure daaliye‚Äîsaari details mil jayengi.`,
      },
      {
        id: 'navigation',
        patterns: ['where is','kaha milega','find','navigate','menu','sections','site map','sitemap'],
        answer: `Site sections: <ul style="margin:6px 0 0 18px">
          <li>üè† Home</li><li>‚ÑπÔ∏è About</li><li>üßÆ Tools</li><li>üí≥ Pricing</li><li>üìû Contact</li>
        </ul> Kisi section pe jana ho to bas naam type kijiye (e.g., "Go to Pricing").`,
      },
      {
        id: 'owner',
        patterns: ['owner rights','delete data','admin','exclusive rights','profile page','managementofro','income & outgoing manager','vasu'],
        answer: `Admin features: owner hi data delete/modify kar sakta hai, users ka profile page alag se hota hai. Zarurat par role-based access enable hota hai.`,
      },
      {
        id: 'fallback',
        patterns: [],
        answer: `Maaf kijiye, mujhe sahi samajh nahi aaya üòÖ. Aap apna sawal thoda aur detail me likh sakte hain? Ya yeh quick options try karein: <span class="chip" onclick="assistant.fill('How do I login?')">Login help</span> <span class="chip" onclick="assistant.fill('Where is pricing?')">Pricing</span> <span class="chip" onclick="assistant.fill('Contact support')">Contact</span>`
      }
    ];

    // Quick chips (edit freely)
    const QUICK_CHIPS = [
      'How do I login?','Where is pricing?','Contact support','EMI calculator','Create new account','Reset password'
    ];

    /***********************************
     * 2) Lightweight Matching Engine  *
     ***********************************/
    function normalize(s){
      return (s||'').toLowerCase().replace(/[^a-z0-9\s]/g,' ').replace(/\s+/g,' ').trim();
    }

    // Simple token overlap + substring + edit distance
    function score(query, patterns){
      query = normalize(query);
      const qTokens = new Set(query.split(' '));
      let best = 0;
      for(const p of patterns){
        const t = normalize(p);
        if(!t) continue;
        let s = 0;
        // direct substring boost
        if(query.includes(t) || t.includes(query)) s += 0.6;
        // token overlap
        const pTokens = new Set(t.split(' '));
        let overlap = 0; pTokens.forEach(tok=>{ if(qTokens.has(tok)) overlap++; });
        s += Math.min(0.4, overlap * 0.1);
        // edit distance (levenshtein) small penalty
        const d = levenshtein(query, t);
        const maxLen = Math.max(query.length, t.length) || 1;
        s += Math.max(0, 0.3 - (d/maxLen));
        best = Math.max(best, s);
      }
      return best; // 0..~1.3
    }

    function levenshtein(a,b){
      a = a||''; b = b||'';
      const m = a.length, n = b.length;
      const dp = Array.from({length:m+1},()=>Array(n+1).fill(0));
      for(let i=0;i<=m;i++) dp[i][0]=i;
      for(let j=0;j<=n;j++) dp[0][j]=j;
      for(let i=1;i<=m;i++){
        for(let j=1;j<=n;j++){
          const cost = (a[i-1]===b[j-1])?0:1;
          dp[i][j] = Math.min(
            dp[i-1][j] + 1,
            dp[i][j-1] + 1,
            dp[i-1][j-1] + cost
          );
        }
      }
      return dp[m][n];
    }

    function findBestQA(text){
      let best = {id:'fallback', score:0};
      for(const item of KB){
        if(item.id==='fallback') continue;
        const s = score(text, item.patterns);
        if(s > best.score){ best = {id:item.id, score:s}; }
      }
      // threshold control
      if(best.score < 0.55) return KB.find(x=>x.id==='fallback');
      return KB.find(x=>x.id===best.id) || KB.find(x=>x.id==='fallback');
    }

    /**********************
     * 3) UI Interaction  *
     **********************/
    const chat = document.getElementById('chat');
    const msgs = document.getElementById('msgs');
    const box = document.getElementById('box');
    const chips = document.getElementById('chips');

    const assistant = {
      open(){ chat.classList.add('open'); setTimeout(()=>box.focus(), 150); if(!assistant._boot){ assistant.boot(); } },
      close(){ chat.classList.remove('open'); },
      boot(){
        assistant._boot = true;
        // quick chips
        QUICK_CHIPS.forEach(label=>{
          const c = document.createElement('span');
          c.className='chip'; c.textContent=label; c.onclick=()=>assistant.fill(label);
          chips.appendChild(c);
        });
        // welcome
        botMsg(`üëã Swagat hai! Main aapko is website par navigate karne, login/pricing/EMI jaise sawalon ka jawab dene me madad karunga. Neeche diye chips pe click karke turant try karein.`);
      },
      fill(text){ box.value = text; box.focus(); },
      fakeAction(type){
        if(type==='reset') botMsg('üîê Password reset: aapka registered email daaliye, hum reset link bhej denge. Check spam folder bhi!');
        if(type==='call') botMsg('üìû Callback request received. Team aapse 24 ghante ke andar sampark karegi.');
        if(type==='emi') botMsg('üßÆ EMI Tool: Principal, Annual Rate (APR) aur Tenure (months) enter karke Calculate dabaiye. Result me EMI, total interest, amortization mil jayega.');
      }
    };
    window.assistant = assistant; // expose for inline links

    function userMsg(text){
      const wrap = document.createElement('div'); wrap.className='msg user';
      wrap.innerHTML = `<div class="bubble">${escapeHtml(text)}</div>`;
      msgs.appendChild(wrap); stamp(); scrollDown();
    }
    function botMsg(html){
      const wrap = document.createElement('div'); wrap.className='msg bot';
      wrap.innerHTML = `<div class="bubble">${html}</div>`;
      msgs.appendChild(wrap); stamp(); scrollDown();
    }
    function stamp(){
      const d = new Date();
      const t = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      const s = document.createElement('div'); s.className='stamp'; s.textContent = t;
      msgs.lastElementChild?.appendChild(s);
    }
    function scrollDown(){ msgs.scrollTop = msgs.scrollHeight; }
    function escapeHtml(str){ return (str||'').replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); }

    async function handleSend(){
      const text = box.value.trim(); if(!text) return; box.value='';
      userMsg(text);
      // intent detection
      const qa = findBestQA(text);
      // command: go to <section>
      const goto = /\b(go to|open|navigate to)\s+([a-z\s]+)$/i.exec(text);
      if(goto){ botMsg(`Opening <b>${escapeHtml(goto[2])}</b>‚Ä¶ (demo)`); return; }
      // normal answer
      await new Promise(r=>setTimeout(r, 250));
      botMsg(qa.answer);
    }

    // events
    document.getElementById('openChat').addEventListener('click', ()=>assistant.open());
    document.getElementById('closeChat').addEventListener('click', ()=>assistant.close());
    document.getElementById('send').addEventListener('click', handleSend);
    box.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); handleSend(); }});

    // Optional: open once on first load after 1.5s
    setTimeout(()=>{ assistant.open(); }, 1500);
  </script>

  <!--
    üîß How to integrate real AI later (OpenAI/any LLM):
    1) Create a backend route /chat that forwards user text to your model API.
    2) Replace the QA lookup in handleSend() with a fetch to /chat.
       Example:
           const res = await fetch('/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({message:text, context:"site-help"}) });
           const data = await res.json();
           botMsg(data.reply || 'Sorry, no reply');
    3) Keep KB as fallback when AI is uncertain or offline.
  -->
</body>
</html>
=======
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Personal AI Assistant (No‚ÄëAPI)</title>
  <style>
    :root{
      --bg:#0b1020;--card:#121936;--accent:#7c5cff;--muted:#9aa4ff;--text:#e9ecff;--sub:#b9c0ff;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial;color:var(--text);background:linear-gradient(135deg,#0b1020,#151a3a 60%,#0b1020)}
    /* Floating launcher */
    .launcher{position:fixed;right:18px;bottom:18px;z-index:9999}
    .launcher button{height:56px;width:56px;border-radius:50%;border:none;cursor:pointer;background:var(--accent);color:#fff;font-size:22px;box-shadow:0 10px 30px rgba(124,92,255,.35);transition:transform .15s ease, box-shadow .3s}
    .launcher button:hover{transform:translateY(-2px);box-shadow:0 14px 38px rgba(124,92,255,.5)}

    /* Chat window */
    .chat{position:fixed;right:18px;bottom:86px;width:360px;max-width:92vw;height:520px;max-height:75vh;background:var(--card);border-radius:18px;overflow:hidden;border:1px solid rgba(255,255,255,.08);box-shadow:0 18px 44px rgba(0,0,0,.45);display:none;flex-direction:column}
    .chat.open{display:flex}
    .top{display:flex;align-items:center;gap:10px;padding:14px 14px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,rgba(255,255,255,.04),transparent)}
    .av{height:34px;width:34px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#4f46e5);display:grid;place-items:center;font-weight:700}
    .title{font-weight:700;font-size:14px}
    .sub{font-size:12px;color:var(--sub)}

    .msgs{flex:1;overflow:auto;padding:12px 12px 8px;scroll-behavior:smooth}
    .msg{display:flex;margin:8px 0;gap:8px}
    .msg .bubble{padding:10px 12px;border-radius:12px;max-width:78%}
    .user .bubble{background:#1b2452;margin-left:auto;border-bottom-right-radius:4px}
    .bot .bubble{background:#0f1533;border:1px solid rgba(255,255,255,.06);border-bottom-left-radius:4px}
    .stamp{font-size:11px;color:var(--sub);margin:2px 4px}

    .input{display:flex;gap:8px;padding:10px;border-top:1px solid rgba(255,255,255,.08);background:linear-gradient(0deg,rgba(255,255,255,.04),transparent)}
    .input input{flex:1;padding:12px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0d1430;color:var(--text)}
    .input button{padding:12px 14px;border-radius:12px;border:none;background:var(--accent);color:#fff;cursor:pointer}

    /* Quick actions */
    .chips{display:flex;flex-wrap:wrap;gap:8px;padding:8px 12px;border-bottom:1px dashed rgba(255,255,255,.08)}
    .chip{padding:7px 10px;border-radius:999px;font-size:12px;background:#141b3c;border:1px solid rgba(255,255,255,.08);cursor:pointer}

    /* Small helper UI */
    .hint{font-size:12px;color:var(--sub);padding:0 12px 6px}
    a.inline{color:var(--muted);text-decoration:none;border-bottom:1px dashed rgba(124,92,255,.4)}

    /* Responsive tweaks */
    @media (max-width:420px){.chat{width:96vw;right:2vw}}
  </style>
</head>
<body>


<head>
  <title>Vercel Test</title>
</head>
<body>
  <h1>Deployment Working ‚úÖ</h1>
</body>

  <!-- Launcher -->
  <div class="launcher" aria-live="polite" aria-label="Open chat">
    <button id="openChat" title="Chat with assistant">üí¨</button>
  </div>

  <!-- Chat Window -->
  <section class="chat" id="chat">
    <header class="top">
      <div class="av">AI</div>
      <div>
        <div class="title">tera bhai hu kuch bhi poch</div>
        <div class="sub">Ask anything ‚Ä¢ Online</div>
      </div>
      <button id="closeChat" style="margin-left:auto;background:transparent;border:none;color:var(--sub);font-size:20px;cursor:pointer">‚úï</button>
    </header>

    <div class="chips" id="chips"></div>
    <div class="hint">Tip: "login kaise karein", "pricing", "contact", "EMI calculator"‚Äîkuch bhi puchhiye.</div>

    <main class="msgs" id="msgs" role="log" aria-live="polite"></main>

    <footer class="input">
      <input id="box" placeholder="Type your question‚Ä¶ (Enter to send)" autocomplete="off" />
      <button id="send">Send ‚Æû</button>
    </footer>
  </section>

  <script>
    /**********************
     * 1) Knowledge Base  *
     **********************/
    // Edit / add Q&A here. Each item can have:
    // - patterns: phrases to detect
    // - answer: HTML/text to send back
    // - actions: optional functions to run (like scroll to a section)
    const KB = [
      {
        id: 'greet',
        patterns: ['hello','hi','hey','namaste','pranam','suprabhat','good morning','good evening'],
        answer: `Namaste! üëã Main aapka site assistant hoon. Bataiye, mai kaise madad karu?`,
      },
      {
        id: 'login',
        patterns: ['login','sign in','signin','account access','how to login','kaise login karu','login kaise kare'],
        answer: `Login karne ke liye top-right pe <b>Login</b> button dabaiye. Agar account nahi hai to <b>Sign Up</b> kijiye, fir email verify karke dubara login kijiye. Password bhool gaye? <a class="inline" href="#" onclick="assistant.fakeAction('reset')">Reset yahan se</a>.`,
      },
      {
        id: 'signup',
        patterns: ['sign up','signup','register','account banana','naya account'],
        answer: `Sign Up ke liye naam, email aur strong password daliye. Verification mail aayega‚Äîconfirm karte hi account ready!`,
      },
      {
        id: 'pricing',
        patterns: ['price','pricing','plan','plans','kitna paisa','charges','fees'],
        answer: `Hamare plans: <ul style="margin:6px 0 0 18px">
          <li><b>Free</b> ‚Äì basic features</li>
          <li><b>Pro</b> ‚Äì ‚Çπ299/month ‚Äì advanced tools</li>
          <li><b>Business</b> ‚Äì custom pricing ‚Äì team features</li>
        </ul> Payment UPI/NetBanking/Cards se ho sakta hai.`,
      },
      {
        id: 'contact',
        patterns: ['contact','support','help','customer care','phone','email','reach out'],
        answer: `Madad chahiye? Hume <a class="inline" href="mailto:support@example.com">support@example.com</a> par mail karein ya <a class="inline" href="#" onclick="assistant.fakeAction('call')">callback request</a> chhodiye.`,
      },
      {
        id: 'emi',
        patterns: ['emi','loan','installment','interest calculator','emi calculator'],
        answer: `EMI calculator yahan milega: <a class="inline" href="#" onclick="assistant.fakeAction('emi')">Open EMI Tool</a>. Principal, rate aur tenure daaliye‚Äîsaari details mil jayengi.`,
      },
      {
        id: 'navigation',
        patterns: ['where is','kaha milega','find','navigate','menu','sections','site map','sitemap'],
        answer: `Site sections: <ul style="margin:6px 0 0 18px">
          <li>üè† Home</li><li>‚ÑπÔ∏è About</li><li>üßÆ Tools</li><li>üí≥ Pricing</li><li>üìû Contact</li>
        </ul> Kisi section pe jana ho to bas naam type kijiye (e.g., "Go to Pricing").`,
      },
      {
        id: 'owner',
        patterns: ['owner rights','delete data','admin','exclusive rights','profile page','managementofro','income & outgoing manager','vasu'],
        answer: `Admin features: owner hi data delete/modify kar sakta hai, users ka profile page alag se hota hai. Zarurat par role-based access enable hota hai.`,
      },
      {
        id: 'fallback',
        patterns: [],
        answer: `Maaf kijiye, mujhe sahi samajh nahi aaya üòÖ. Aap apna sawal thoda aur detail me likh sakte hain? Ya yeh quick options try karein: <span class="chip" onclick="assistant.fill('How do I login?')">Login help</span> <span class="chip" onclick="assistant.fill('Where is pricing?')">Pricing</span> <span class="chip" onclick="assistant.fill('Contact support')">Contact</span>`
      }
    ];

    // Quick chips (edit freely)
    const QUICK_CHIPS = [
      'How do I login?','Where is pricing?','Contact support','EMI calculator','Create new account','Reset password'
    ];

    /***********************************
     * 2) Lightweight Matching Engine  *
     ***********************************/
    function normalize(s){
      return (s||'').toLowerCase().replace(/[^a-z0-9\s]/g,' ').replace(/\s+/g,' ').trim();
    }

    // Simple token overlap + substring + edit distance
    function score(query, patterns){
      query = normalize(query);
      const qTokens = new Set(query.split(' '));
      let best = 0;
      for(const p of patterns){
        const t = normalize(p);
        if(!t) continue;
        let s = 0;
        // direct substring boost
        if(query.includes(t) || t.includes(query)) s += 0.6;
        // token overlap
        const pTokens = new Set(t.split(' '));
        let overlap = 0; pTokens.forEach(tok=>{ if(qTokens.has(tok)) overlap++; });
        s += Math.min(0.4, overlap * 0.1);
        // edit distance (levenshtein) small penalty
        const d = levenshtein(query, t);
        const maxLen = Math.max(query.length, t.length) || 1;
        s += Math.max(0, 0.3 - (d/maxLen));
        best = Math.max(best, s);
      }
      return best; // 0..~1.3
    }

    function levenshtein(a,b){
      a = a||''; b = b||'';
      const m = a.length, n = b.length;
      const dp = Array.from({length:m+1},()=>Array(n+1).fill(0));
      for(let i=0;i<=m;i++) dp[i][0]=i;
      for(let j=0;j<=n;j++) dp[0][j]=j;
      for(let i=1;i<=m;i++){
        for(let j=1;j<=n;j++){
          const cost = (a[i-1]===b[j-1])?0:1;
          dp[i][j] = Math.min(
            dp[i-1][j] + 1,
            dp[i][j-1] + 1,
            dp[i-1][j-1] + cost
          );
        }
      }
      return dp[m][n];
    }

    function findBestQA(text){
      let best = {id:'fallback', score:0};
      for(const item of KB){
        if(item.id==='fallback') continue;
        const s = score(text, item.patterns);
        if(s > best.score){ best = {id:item.id, score:s}; }
      }
      // threshold control
      if(best.score < 0.55) return KB.find(x=>x.id==='fallback');
      return KB.find(x=>x.id===best.id) || KB.find(x=>x.id==='fallback');
    }

    /**********************
     * 3) UI Interaction  *
     **********************/
    const chat = document.getElementById('chat');
    const msgs = document.getElementById('msgs');
    const box = document.getElementById('box');
    const chips = document.getElementById('chips');

    const assistant = {
      open(){ chat.classList.add('open'); setTimeout(()=>box.focus(), 150); if(!assistant._boot){ assistant.boot(); } },
      close(){ chat.classList.remove('open'); },
      boot(){
        assistant._boot = true;
        // quick chips
        QUICK_CHIPS.forEach(label=>{
          const c = document.createElement('span');
          c.className='chip'; c.textContent=label; c.onclick=()=>assistant.fill(label);
          chips.appendChild(c);
        });
        // welcome
        botMsg(`üëã Swagat hai! Main aapko is website par navigate karne, login/pricing/EMI jaise sawalon ka jawab dene me madad karunga. Neeche diye chips pe click karke turant try karein.`);
      },
      fill(text){ box.value = text; box.focus(); },
      fakeAction(type){
        if(type==='reset') botMsg('üîê Password reset: aapka registered email daaliye, hum reset link bhej denge. Check spam folder bhi!');
        if(type==='call') botMsg('üìû Callback request received. Team aapse 24 ghante ke andar sampark karegi.');
        if(type==='emi') botMsg('üßÆ EMI Tool: Principal, Annual Rate (APR) aur Tenure (months) enter karke Calculate dabaiye. Result me EMI, total interest, amortization mil jayega.');
      }
    };
    window.assistant = assistant; // expose for inline links

    function userMsg(text){
      const wrap = document.createElement('div'); wrap.className='msg user';
      wrap.innerHTML = `<div class="bubble">${escapeHtml(text)}</div>`;
      msgs.appendChild(wrap); stamp(); scrollDown();
    }
    function botMsg(html){
      const wrap = document.createElement('div'); wrap.className='msg bot';
      wrap.innerHTML = `<div class="bubble">${html}</div>`;
      msgs.appendChild(wrap); stamp(); scrollDown();
    }
    function stamp(){
      const d = new Date();
      const t = d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      const s = document.createElement('div'); s.className='stamp'; s.textContent = t;
      msgs.lastElementChild?.appendChild(s);
    }
    function scrollDown(){ msgs.scrollTop = msgs.scrollHeight; }
    function escapeHtml(str){ return (str||'').replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); }

    async function handleSend(){
      const text = box.value.trim(); if(!text) return; box.value='';
      userMsg(text);
      // intent detection
      const qa = findBestQA(text);
      // command: go to <section>
      const goto = /\b(go to|open|navigate to)\s+([a-z\s]+)$/i.exec(text);
      if(goto){ botMsg(`Opening <b>${escapeHtml(goto[2])}</b>‚Ä¶ (demo)`); return; }
      // normal answer
      await new Promise(r=>setTimeout(r, 250));
      botMsg(qa.answer);
    }

    // events
    document.getElementById('openChat').addEventListener('click', ()=>assistant.open());
    document.getElementById('closeChat').addEventListener('click', ()=>assistant.close());
    document.getElementById('send').addEventListener('click', handleSend);
    box.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); handleSend(); }});

    // Optional: open once on first load after 1.5s
    setTimeout(()=>{ assistant.open(); }, 1500);
  </script>

  <!--
    üîß How to integrate real AI later (OpenAI/any LLM):
    1) Create a backend route /chat that forwards user text to your model API.
    2) Replace the QA lookup in handleSend() with a fetch to /chat.
       Example:
           const res = await fetch('/chat', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({message:text, context:"site-help"}) });
           const data = await res.json();
           botMsg(data.reply || 'Sorry, no reply');
    3) Keep KB as fallback when AI is uncertain or offline.
  -->
</body>
</html>

>>>>>>> 2daed264cd25bf2191e4b687785ff44537a09cf2
